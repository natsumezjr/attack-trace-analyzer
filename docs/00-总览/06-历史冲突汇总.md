# 冲突汇总

> 迁移过程中发现的冲突与不确定项统一记录在本文件，迁移完成后集中讨论与裁决。

## 记录格式

- 编号：CONFLICT-001（递增）
- 冲突类型：文档↔文档 / 文档↔代码 / 需求↔实现 / 命名冲突 / 其它
- 位置：涉及的旧文档路径/代码路径与关键信息
- 冲突点：一句话描述矛盾
- 当前处理：本次迁移采取的暂定口径（必须确定），以及原因
- 后续需要你确认的问题：一句话问题列表

---

## 冲突列表

### CONFLICT-001

- 冲突类型：文档↔代码
- 位置：
  - 历史路径：`docs/06C-客户端中心机接口规范.md`（已删除）
  - 代码：`client/backend/main.go`
- 冲突点：旧文档要求“中心机轮询 /api/v1/pull + cursor + Bearer token”，但当前客户端实现提供的是 `GET /falco`、`GET /suricata`、`GET /filebeat`，且以 RabbitMQ 队列消费作为增量机制。
- 当前处理：新文档以当前客户端 HTTP API + RabbitMQ 队列语义作为权威口径（见 `../80-规范/87-客户机与中心机接口.md`）。
- 后续需要你确认的问题：无。

### CONFLICT-002

- 冲突类型：文档↔文档
- 位置：
  - 旧文档：根目录 `README.md`
  - 历史路径：`client/README.md`（已删除）
- 冲突点：旧 README 曾描述客户端具备“注册 + /health + /pull”，与当前代码实现不一致。
- 当前处理：仓库根 `README.md` 已更新并以 `docs/` 为唯一文档入口；客户端接口口径以 `../80-规范/87-客户机与中心机接口.md` 为准。
- 后续需要你确认的问题：无。

### CONFLICT-003

- 冲突类型：文档↔代码
- 位置：
  - 历史路径：`docs/05-模块与数据流说明.md`、`docs/06-数据库设计.md`（已删除）
  - 代码：`client/docker-compose.yml`、`client/sensor/**`、`client/backend/main.go`
- 冲突点：旧文档把“ECS 归一化”归因到“Go 客户端后端”，但当前实现中 ECS 转换发生在各传感器/转换器容器里，Go 服务负责从 RabbitMQ 队列拉取消息并对外提供查询/拉取接口。
- 当前处理：新文档把“归一化责任”定义为“客户机侧采集与转换流水线（传感器/转换器）”，Go 服务的职责定义为“对外提供中心机拉取接口 + 读 RabbitMQ 队列缓冲”（见 `../50-详细设计/客户机/50-总体.md` 与 `../80-规范/81-ECS字段规范.md`）。
- 后续需要你确认的问题：无。

### CONFLICT-004

- 冲突类型：文档↔文档/代码
- 位置：
  - 历史路径：`docs/08-后端运行与联调指南.md`（已删除）
  - 历史路径：`docs/09-实体图谱节点与关系规范v2.md`（已删除）
  - 代码：`backend/app/services/neo4j/models.py`、`backend/app/services/neo4j/db.py`
- 冲突点：`docs/08` 中"关系类型（当前代码实现）"与 `docs/09(v2)`、以及实际代码的 `RelType` 枚举不一致（例如旧文档提到 `NetConn`、`PARENT_OF/USES/OWNS/CONNECTED`，但当前实现与 v2 规范采用 `SPAWN/FILE_ACCESS/NET_CONNECT` 且不引入 `NetConn` 节点）。
- 当前处理：新文档以实体图谱规范为唯一权威口径，并对齐到当前 `backend/app/services/neo4j/*` 的实现（不引入 `NetConn` 节点）（见 `../80-规范/84-Neo4j实体图谱规范.md`）。
- 后续需要你确认的问题：无。

### CONFLICT-005

- 冲突类型：文档↔代码
- 位置：
  - 代码：`client/sensor/falco/ecs-converter/falco_json_to_ecs.py`
  - 代码：`client/sensor/suricata/exporter/app.py`
  - 代码：`client/sensor/filebeat/detector.py`
  - 新文档：`../80-规范/81-ECS字段规范.md`
- 冲突点：客户机侧三路数据源当前输出的 ECS 形态不一致（ECS 版本混用、dataset 命名不一致、部分事件缺失 `event.id`/`message` 等公共字段），与新文档规定的“ECS 子集 v9.2.0 + 统一 dataset 体系 + 全量 `event.id` 幂等键”不一致。
- 当前处理：新文档将 ECS 子集 v9.2.0 与 dataset 体系作为权威口径；客户端对外返回前必须补齐稳定 `event.id`（sha1(RabbitMQ 原始消息体字节)），中心机在入库 Step 2 执行最终字段规范化（时间字段、host.id、ecs.version、dataset/shape 规范化等），不把“传感器原始输出形态”作为对中心机的契约。
- 后续需要你确认的问题：无。
