# 开源项目调研与借鉴清单（面向 3 天开发窗口）

> 本文档将题目要求拆解为“可落地能力清单”，并记录调研结论与最终选型理由。  
> 目标是形成一个可演示、可验收、可写进报告的系统闭环（技术路线唯一，不保留分支方案）。

## 0. 本项目最终选型（已拍板）

为避免"调研清单"与"最终实现"混淆，先给出本项目最终选型（以 `docs/00-文档索引.md` 中的规格文档为准）：

- 存储/检索：OpenSearch
- 库内检测：OpenSearch Security Analytics（Sigma 规则）
- 图谱与图算法：Neo4j + Neo4j GDS（加权最短路｜路径重建）
- 中心机后端：Python FastAPI + uv（API、注册表、轮询器）
- 中心机前端：Next.js + React（页面展示、可视化）
- 主机侧：Filebeat（主机系统日志） + Sigma（规则检测） + Falco（主机行为告警）
- 网络侧：Suricata（统一作为网络流量数据源，EVE JSON 同时产出事实与告警）
- 统一范式：ECS v9.2.0 + 自定义字段 `custom.*`
- TTP 知识库：离线 MITRE ATT&CK Enterprise CTI（STIX 2.1｜attack-stix-data，Intrusion Set ↔ Technique）
- 攻击复现：Atomic Red Team
- 输出导出：ATT&CK Navigator layer
- Python 包管理：uv（快速、可靠的 Python 包管理器）

明确不纳入最终实现：

- Caldera（多阶段自动编排）
- Attack Flow（结构化攻击链导出）
- osquery（主机状态查询/实体补全）
- Arkime（PCAP/会话回放增强）
- OpenCTI / MISP / TheHive / Cortex / SpiderFoot / IntelOwl（平台型情报与富化组件；中心机运行环境离线）

> 本文档后续内容记录调研过但未纳入最终实现的组件与理由，用于支撑“为什么这么选”的答辩叙事；最终实现以以上选型为准。

## 1. 题目要求拆解（能力清单）

作业核心可以归纳为 6 个硬指标：

1) **多源采集**：主机日志 + 主机行为 + 网络流量  
2) **统一与融合**：时间对齐、范式化（统一字段）、关键实体抽取、登录会话重建  
3) **关联分析**：时间线聚合 + 因果/链路推断 + 实体关系图  
4) **ATT&CK 攻击链**：把事件映射到 ATT&CK 阶段/技术点，并能串成链  
5) **溯源**：初始入侵点、横向移动、提权、外传路径（以及基础设施/指纹的演示级增强）  
6) **靶场验证**：≥5 节点，能复现实验并验证关联/溯源结果  

## 2. “整套平台”优先（节省集成时间）

### 2.1 Malcolm（偏网络侧全家桶）

可快速部署网络流量分析“全家桶”套件（本项目最终不选用全家桶方案，网络侧统一只用 Suricata）。

适配点：

- 网络流量捕获/解析、会话重建（全家桶平台自带）
- 规则告警（Suricata）
- 一体化检索与看板（省前端与存储集成）

### 2.2 Security Onion（偏教学/实验室场景）

面向威胁狩猎、日志管理与检测展示，常集成 Suricata/osquery/Elastic 栈等。

适配点：

- 网络 + 主机侧日志汇聚与展示
- 自带狩猎与可视化界面，适合课程演示

### 2.3 Filebeat + Sigma（主机侧日志采集与检测）

主机系统日志采集采用 **Filebeat**（轻量、易部署、生态成熟），规则检测采用 **Sigma**（规则通用、便于复用与展示），作为本项目主机侧三件套之一（见 0 节“最终选型”）。

适配点：

- 主机系统日志采集（auth/syslog/kern 等）→ ECS
- Sigma 规则检测产出 Findings（可映射 ATT&CK tag，用于答辩展示）
- 相对“平台型方案”更轻量，适合 3 天窗口与 5 节点靶场复制部署

### 2.4 HELK（偏狩猎/关联/Notebook）

强调狩猎用例、关联分析与可探索性，适合做“关联推断/图/统计窗口”的演示。

风险：

- 组件组合较多，部署复杂度可能高于 Malcolm/主机侧三件套（Filebeat+Sigma+Falco）。

### 2.5 FastAPI（中心机后端框架）

> 本项目中心机后端以 **Python FastAPI** 为核心：承担后端 API（注册表、轮询拉取、入库与关联算法触发）。
> 接口语义见：`docs/06C-客户端中心机接口规范.md`

适配点：

- **现代化 Python Web 框架**：自动生成 OpenAPI 文档，类型安全，异步支持
- **与 Python 生态无缝集成**：直接调用 analyzer 模块的算法函数，无需跨语言调用
- **性能优秀**：基于 Starlette 和 Pydantic，比传统 Flask/Django 更快
- **易用性强**：自动请求验证、序列化、依赖注入，3 天窗口更容易快速开发
- **包管理使用 uv**：快速、可靠的 Python 包管理器，比 pip 更快更安全

### 2.6 Next.js（中心机前端框架）

> 本项目中心机前端以 **Next.js + React** 为核心：承担页面展示、可视化、报告导出等用户界面。

适配点：

- **React 生态成熟**：丰富的图表库（Recharts、D3.js）、组件库
- **SSR/SSG 支持**：更好的首屏加载性能
- **TypeScript 原生支持**：类型安全，开发体验好
- **与后端分离**：通过 RESTful API 调用 FastAPI 后端

## 3. 主机行为监控（3 天不做内核开发：直接复用传感器）

题目里的“系统调用拦截/进程链/文件操作/内存行为”不建议从零实现，建议直接采集高层事件或规则命中事件。

### 3.1 Falco（eBPF/运行时安全）

> 本项目最终实现：**主机行为监控只使用 Falco**（不引入其他传感器）。  
> 快速启动参考：`https://falco.org/docs/getting-started/falco-docker-quickstart/`

适配点：

- 内核行为观测（eBPF/内核事件），但课程项目不做全量 syscall 入库
- Falco **规则命中事件（alert）**可直接作为主机行为信号（Detect-first），用于串进程链/文件访问/可疑外联等证据

### 3.2 osquery（主机实体抽取友好）

> 本项目最终实现：**不引入 osquery**（保持主机侧信号来源为 Filebeat/Falco/Suricata）。  
> 实体补全/证据补采不作为 v1 目标。

适配点：

- 用 SQL 查询主机状态：进程、网络连接、用户、文件信息等
- 适合作为“证据补采/实体补全”

## 4. 网络流量分析与隐蔽信道：常用组件

### 4.1 Suricata（事实 + 告警一体）

适配点：

- EVE JSON 同时产出事实日志（flow/dns/http/tls…）与告警（alert）
- IDS/NSM 告警输出可直接当 Findings（Detect-first）
- 可用现成规则覆盖典型异常，再补少量课程自定义检测

### 4.2 Arkime（全流量索引与会话检索）

> 本项目最终实现：**不引入 Arkime**；网络侧统一只使用 Suricata（见 0 节“最终选型”）。  
> PCAP 回放与会话检索不作为 v1 目标。

适配点：

- 对“下载/外联/外传会话”复盘非常直观

## 5. 统一范式与数据融合：不要自创字段

### 5.1 ECS（Elastic Common Schema）

建议用 ECS（至少用其思想与字段集合）做统一范式：

- `process.*`、`user.*`、`file.*`、`source.* / destination.*`、`event.*` 等字段一旦统一，跨源关联会变得非常直接。

### 5.2 采集/处理管道（轻量优先）

调研组件（本项目不纳入最终实现）：

- Fluent Bit：轻量采集与转发
- Vector：高性能管道，适合做字段转换/富化
- OpenTelemetry Collector：统一收集/处理/导出

## 6. 关联分析与攻击链：可复用的生态

### 6.1 Timesketch（取证时间线分析）

适配点：

- 非常贴合“多源数据时间线关联分析”的要求

### 6.2 ATT&CK Navigator（矩阵可视化）

适配点：

- 将命中 technique 的覆盖情况输出为 layer，用于答辩展示

### 6.3 Sigma 规则库（大量现成检测规则）

适配点：

- 作为“事件→Technique Finding”的素材库
- 配合 Security Analytics 做 Store-first 检测

### 6.4 Attack Flow（结构化攻击链表达）

适配点：

- 用 JSON 表达“攻击步骤与关系”，可作为系统输出格式
- 本项目最终实现 **不纳入** Attack Flow；攻击链输出以 `attack-chains-*` + Neo4j 子图引用 + Navigator layer 为准。

## 7. 测试/复现与靶场（快速凑齐 ≥5 节点）

### 7.1 DetectionLab（自动化搭建域环境）

适配点：

- 快速拉起多节点与安全日志最佳实践环境（适合课程靶场）

### 7.2 Atomic Red Team（按 ATT&CK technique 复现）

适配点：

- 不用手写攻击脚本：直接跑 technique → 产生日志/流量 → 验证系统“能命中 + 能串链”
- 本项目最终实现 **不引入** Caldera（多阶段自动编排），只使用 Atomic Red Team。

## 8. 溯源增强（情报/基础设施）：本项目落地方案

题目中提到的“C2 注册信息、历史记录、关联域名”等属于 CTI/OSINT。本项目中心机运行环境离线，因此溯源增强采取“离线知识库 + 本地观测数据”的落地方式：

- 离线 MITRE ATT&CK Enterprise CTI（STIX 2.1｜attack-stix-data）数据包：提供 Intrusion Set ↔ Technique 映射，用于 TTP 相似性匹配
- 基于 Suricata 的 DNS/流量观测：构建域名 ↔ IP ↔ 会话的基础设施关联证据

## 9. 3 天现实版落地组合（可直接写进"总体方案"）

本项目落地组合如下（与 0 节"最终选型"一致）：

- 网络侧：Suricata（EVE JSON：flow/dns/http… + alert → 统一 ECS 入库 OpenSearch）
- 主机侧：Filebeat（主机系统日志采集） + Sigma（规则检测）
- 主机行为：Falco（产出行为告警/高价值行为事件）
- 统一字段：ECS（统一范式）
- 图谱与图算法：Neo4j + GDS（加权最短路｜路径重建）
- 知识库：离线 MITRE ATT&CK Enterprise CTI（STIX 2.1｜attack-stix-data）
- 攻击链输出：ATT&CK Navigator layer
- 靶场：自建 ≥5 节点 Linux 靶场
- 攻击复现：Atomic Red Team
- 中心机后端：Python FastAPI + uv（API、注册表、轮询器、入库路由）
- 中心机前端：Next.js + React（页面展示、可视化、报告导出）

自研重点收敛到：

- Findings 的统一结构与字段补全（胶水层）
- 时间窗关联（Δt）+ 实体关系图构建
- 攻击路径重建（入侵→横向→外传）与报告输出
- APT/TTP 相似度 Top-N（解释性输出）
