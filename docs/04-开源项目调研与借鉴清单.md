# 开源项目调研与借鉴清单（面向 3 天开发窗口）

> 本文档将题目要求拆解为“可落地能力清单”，并整理可借鉴/复用的开源平台与组件。  
> 目的不是“做全做深”，而是快速拼装出可演示、可验收、可写进报告的系统闭环。

## 0. 本项目最终选型（已拍板）

为避免“调研清单”与“最终实现”混淆，先给出本项目最终选型（详见 `docs/99-选型决策记录.md`）：

- 存储/检索：OpenSearch
- 库内检测：OpenSearch Security Analytics（Sigma 规则）
- 图谱：Neo4j
- 主机侧（Linux 为主）：auditd + auth.log（事实） + Falco（主机行为告警）
- 网络侧：Zeek（事实） + Suricata（告警）
- 统一范式：ECS v9.2.0 + 自定义字段 `ata.*`
- 攻击复现：Atomic Red Team
- 输出导出：ATT&CK Navigator layer

明确不纳入最终实现：

- Caldera（多阶段自动编排）
- Attack Flow（结构化攻击链导出）
- Arkime（PCAP/会话回放增强）

> 本文档后续内容为“可借鉴/可替换/可加分”的开源方案池；最终实现以以上选型为准。

## 1. 题目要求拆解（能力清单）

作业核心可以归纳为 6 个硬指标：

1) **多源采集**：主机日志 + 主机行为 + 网络流量  
2) **统一与融合**：时间对齐、范式化（统一字段）、关键实体抽取、登录会话重建  
3) **关联分析**：时间线聚合 + 因果/链路推断 + 实体关系图  
4) **ATT&CK 攻击链**：把事件映射到 ATT&CK 阶段/技术点，并能串成链  
5) **溯源**：初始入侵点、横向移动、提权、外传路径（以及基础设施/指纹的演示级增强）  
6) **靶场验证**：≥5 节点，能复现实验并验证关联/溯源结果  

## 2. “整套平台”优先（节省集成时间）

### 2.1 Malcolm（偏网络侧全家桶）

可快速部署网络流量分析套件，常见组合包括：Zeek + Suricata + Arkime +（OpenSearch/可视化）。

适配点：

- 网络流量捕获/解析、会话重建（Zeek/Arkime）
- 规则告警（Suricata）
- 一体化检索与看板（省前端与存储集成）

### 2.2 Security Onion（偏教学/实验室场景）

面向威胁狩猎、日志管理与检测展示，常集成 Zeek/Suricata/osquery/Elastic 栈等。

适配点：

- 网络 + 主机侧日志汇聚与展示
- 自带狩猎与可视化界面，适合课程演示

### 2.3 Wazuh（偏主机侧 SIEM/XDR）

主机日志采集与检测响应平台，常配合 auditd/Sysmon；并带 MITRE ATT&CK 映射展示（用于答辩很加分）。

适配点：

- 主机日志采集与告警（Detect-first）
- ATT&CK 映射（tactic/technique）

### 2.4 HELK（偏狩猎/关联/Notebook）

强调狩猎用例、关联分析与可探索性，适合做“关联推断/图/统计窗口”的演示。

风险：

- 组件组合较多，部署复杂度可能高于 Malcolm/Wazuh。

## 3. 主机行为监控（3 天不做内核开发：直接复用传感器）

题目里的“系统调用拦截/进程链/文件操作/内存行为”不建议从零实现，建议直接采集高层事件或规则命中事件。

### 3.1 Falco / Tracee / Tetragon（eBPF/运行时安全）

适配点：

- 系统调用级观测（但建议只上报高价值事件/规则命中）
- 进程/文件/网络行为可作为“主机行为”数据源

### 3.2 osquery（主机实体抽取友好）

适配点：

- 用 SQL 查询主机状态：进程、网络连接、用户、文件信息等
- 适合作为“证据补采/实体补全”

### 3.3 auditd / Sysmon（偏事实日志）

适配点：

- 提供可复现、可解释的系统活动记录
- 适合 Store-first：入库后用规则扫描产 Findings

## 4. 网络流量分析与隐蔽信道：常用组件

### 4.1 Zeek（高保真协议事实日志）

适配点：

- 会话重建（conn/dns/http/tls…）
- 协议行为建模与自定义脚本检测（可做 DNS 隧道等演示）

### 4.2 Suricata（规则生态强，直接产告警）

适配点：

- IDS/NSM 告警输出可直接当 Findings（Detect-first）
- 可用现成规则覆盖典型异常，再补少量课程自定义检测

### 4.3 Arkime（全流量索引与会话检索）

适配点：

- 对“下载/外联/外传会话”复盘非常直观

## 5. 统一范式与数据融合：不要自创字段

### 5.1 ECS（Elastic Common Schema）

建议用 ECS（至少用其思想与字段集合）做统一范式：

- `process.*`、`user.*`、`file.*`、`source.* / destination.*`、`event.*` 等字段一旦统一，跨源关联会变得非常直接。

### 5.2 采集/处理管道（轻量优先）

可选组件：

- Fluent Bit：轻量采集与转发
- Vector：高性能管道，适合做字段转换/富化
- OpenTelemetry Collector：统一收集/处理/导出（如需写进报告可加分）

## 6. 关联分析与攻击链：可复用的生态

### 6.1 Timesketch（取证时间线分析）

适配点：

- 非常贴合“多源数据时间线关联分析”的要求

### 6.2 ATT&CK Navigator（矩阵可视化）

适配点：

- 将命中 technique 的覆盖情况输出为 layer，用于答辩展示

### 6.3 Sigma 规则库（大量现成检测规则）

适配点：

- 作为“事件→Technique Finding”的素材库
- 配合 Security Analytics 做 Store-first 检测

### 6.4 Attack Flow（结构化攻击链表达）

适配点：

- 用 JSON 表达“攻击步骤与关系”，可作为系统输出格式
- 本项目最终实现 **不纳入** Attack Flow（见 `docs/99-选型决策记录.md`），此处仅作为调研候选项保留。

## 7. 测试/复现与靶场（快速凑齐 ≥5 节点）

### 7.1 DetectionLab（自动化搭建域环境）

适配点：

- 快速拉起多节点与安全日志最佳实践环境（适合课程靶场）

### 7.2 Atomic Red Team（按 ATT&CK technique 复现）

适配点：

- 不用手写攻击脚本：直接跑 technique → 产生日志/流量 → 验证系统“能命中 + 能串链”
- 本项目最终实现 **不引入** Caldera（多阶段自动编排），只使用 Atomic Red Team。

## 8. 溯源增强（情报/基础设施）：演示级可选

题目中提到的“C2 注册信息、历史记录、关联域名”等属于 CTI/OSINT。3 天内不建议做深，但可做“可演示的富化增强”：

- OpenCTI：威胁情报知识库与可视化
- MISP：指标/情报管理
- TheHive + Cortex：事件响应 + 可插拔分析器
- SpiderFoot / IntelOwl：对 IP/域名/文件等 observable 做自动化富化
- YARA：对落地样本/脚本做特征匹配

## 9. 3 天现实版推荐组合（可直接写进“总体方案”）

在风险最低、最容易出结果的情况下，可以采用：

- 网络侧：Malcolm（Zeek + Suricata + Arkime + OpenSearch）
- 主机侧：Wazuh（采集 + 检测 + ATT&CK 映射）
- 主机行为补强：Tracee 或 Falco（产出行为告警/高价值行为事件）
- 统一字段：ECS（统一范式）
- 攻击链输出：ATT&CK Navigator layer（本项目采用；Attack Flow 不纳入最终实现）
- 靶场：DetectionLab（或自建）满足 ≥5 节点
- 攻击复现：Atomic Red Team（本项目采用；不引入 Caldera）

自研重点收敛到：

- Findings 的统一结构与字段补全（胶水层）
- 时间窗关联（Δt）+ 实体关系图构建
- 攻击路径重建（入侵→横向→外传）与报告输出
- APT/TTP 相似度 Top-N（解释性输出）
