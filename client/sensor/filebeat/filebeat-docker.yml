# Filebeat 配置 - Docker 版本
# 监控挂载到容器的宿主机日志

filebeat.inputs:
  # 宿主机 auth 日志
  - type: log
    enabled: true
    paths:
      - /var/log/host/auth.log
      - /var/log/host/auth.log.*
    exclude_lines: ['^\s*$']  # 排除空行
    fields:
      log_type: auth
    fields_under_root: true

  # 宿主机系统日志
  - type: log
    enabled: true
    paths:
      - /var/log/host/syslog
      - /var/log/host/syslog.*
    exclude_lines: ['^\s*$']
    fields:
      log_type: syslog
    fields_under_root: true

  # 宿主机内核日志
  - type: log
    enabled: true
    paths:
      - /var/log/host/kern.log
      - /var/log/host/kern.log.*
    exclude_lines: ['^\s*$']
    fields:
      log_type: kernel
    fields_under_root: true

# ECS 格式处理器
processors:
  - add_host_metadata:
      when.not.contains.tags: forwarded
      netinfo.enabled: false

  - add_docker_metadata:
      host: "unix:///var/run/docker.sock"
      match_source: true
      match_source_index: 4

  # 添加 ECS 字段
  - add_fields:
      target: ''
      fields:
        ecs.version: "8.0.0"

  # 字段重命名
  - rename:
      fields:
        - from: "log.file.path"
          to: "log.origin.file.path"
      ignore_missing: true

# 输出到文件
output.file:
  path: "/tmp/filebeat-output"
  filename: ecs_logs.json
  codec.json:
    pretty: false
    escape_html: false
  rotate_every_kb: 10240
  number_of_files: 5

# 日志配置
logging.level: info
logging.to_files: false
logging.to_stderr: true
