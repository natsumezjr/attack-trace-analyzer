# 验证清单（网络 / 采集 / 证据）

你作为靶场负责人，最重要的不是“把所有功能跑出来”，而是把下面三件事验证到位，并能向组内/老师复述清楚：

1) **网络是通的**（端口与连通性）
2) **采集是活的**（SQLite 持续增长）
3) **证据是可观测的**（做安全动作后，日志/行为/流量都能看到变化）

---

## 1. 网络连通性（必须）

### 1.1 中心机端口（center-01）

- OpenSearch：`9200/9600`
- Neo4j：`7474/7687`
- 后端：`8000`
- 前端：`3000`

验收标准：

- 这些端口在宿主机上可访问（至少本机 curl/wget 能通）
- 如果需要给组员/老师访问，内网其他机器也能通（安全组/防火墙已放行）

### 1.2 客户机端口（client-01..04）

验收标准（每个实例都要过）：

- `http://<server_ip>:1888X/filebeat` 可访问
- `http://<server_ip>:1888X/falco` 可访问
- `http://<server_ip>:1888X/suricata` 可访问

### 1.3 C2 端口（c2-01）

验收标准：

- DNS：53/udp + 53/tcp 可用（能解析 `c2.lab.local`）
- HTTP：80/tcp 可用（能访问 `/health`）

---

## 2. 采集链路（必须）

对每个 client 实例验收：

- `data.db` 存在
- 三张表（`filebeat/falco/suricata`）能随时间增长

> 你们当前 client API 是“全表返回”，所以最简单的验收就是：执行动作前后对比 `total` 是否上升。

---

## 3. “安全动作 → 证据”验证（必须）

下面这些动作不涉及真实入侵，只为产生证据。

### 3.1 DNS 证据（建议用 c2.lab.local）

动作：发起一次 DNS 查询（例如 `dig` / `nslookup`）

验收标准：

- Suricata 表里出现 DNS 相关记录（或至少有网络流量增长）
- 若 C2 使用 macvlan 独立 IP：**推荐在宿主机 `macvlan0` 上抓包**，能抓到到 `10.92.35.50:53` 的流量  
  （你若把 `10.92.35.50/51` 的 `/32` 路由指到 `macvlan0`，那么在 `ens5f1` 上抓到 0 包是正常现象）

### 3.2 HTTP 证据（访问 c2 的 /health）

动作：访问 `http://c2.lab.local/health`

验收标准：

- Suricata 表里出现 HTTP/flow 相关记录（或流量增长）
- **推荐在宿主机 `macvlan0` 上抓包**，能抓到到 `10.92.35.51:80` 的流量（macvlan 方案）

### 3.3 主机日志证据（登录/认证）

动作：从外部机器（如果没有，就用同机不同用户/不同端口做区分）发起一次 SSH 登录

验收标准：

- Filebeat 表里出现 auth/syslog 相关新增
- Suricata 表里出现 SSH/flow 相关新增

### 3.4 主机行为证据（文件读写）

动作：在 `/tmp` 下创建/写入/读取/删除一个文件

验收标准：

- Falco 表里新增（可能是规则触发或 syscall 相关记录）
- Filebeat 表里可能新增 syslog 记录（取决于系统配置）

---

## 4. 你最终要交付给组内的“截图/证据点”

建议你至少准备这些截图/输出（演示时非常省事）：

- `ss -lntup`：端口规划已就绪
- c2 的 DNS 解析结果：`c2.lab.local -> 10.92.35.51`
- 访问 `http://c2.lab.local/health`（或 `http://10.92.35.51/health`）的 200 响应
- 对任意一个 client：三张表的 `total` 在动作前后确实增长

