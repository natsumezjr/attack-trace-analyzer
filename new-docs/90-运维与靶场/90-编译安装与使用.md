# 编译安装与使用

## 文档目的

本文件给出从零开始部署并运行本项目的固定步骤，包含前置依赖、启动顺序、健康检查、常用操作与停机清理。

## 读者对象

- 负责部署与联调的同学
- 负责现场演示的同学

## 引用关系

- 靶场部署：`91-靶场部署.md`
- 一键编排：`92-一键编排.md`
- 验证清单：`94-验证清单.md`

## 1. 前置依赖

本项目运行依赖固定为：

- Docker Engine（支持 `docker compose`）
- Node.js + npm（用于前端）
- Python 3.12 + uv（用于后端）

> 说明：Go 用于客户机服务的镜像构建，本项目运行时不要求宿主机安装 Go。

## 2. 启动顺序

启动顺序固定为：

1. 启动中心机依赖（OpenSearch、Neo4j）
2. 启动 C2（DNS+HTTP）
3. 启动客户机采集栈
4. 启动中心机后端（FastAPI）
5. 启动中心机前端（Next.js）
6. 注册客户机到中心机
7. 执行证据动作并按验证清单验收

## 3. 健康检查

### 3.1 后端健康检查

```bash
curl -sS http://localhost:8000/health
```

预期输出固定为：

```json
{"status":"ok"}
```

### 3.2 OpenSearch 健康检查

```bash
curl -k -sS -u admin:OpenSearch@2024!Dev https://localhost:9200/_cluster/health
```

预期输出包含字段 `status`，其值为 `yellow` 或 `green`。

## 4. 常用操作

### 4.1 启动全部服务

启动命令在 `92-一键编排.md` 定义，本文件不重复。

### 4.2 服务访问入口（固定）

- 前端：`http://10.92.35.13:3000`
- 后端健康检查：`http://10.92.35.13:8000/health`
- Neo4j Browser：`http://10.92.35.13:7474`
- OpenSearch：`https://10.92.35.13:9200`
- RabbitMQ 管理界面：`http://10.92.35.13:15672`
- 客户机拉取接口：
  - `http://10.92.35.13:8888/falco`
  - `http://10.92.35.13:8888/filebeat`
  - `http://10.92.35.13:8888/suricata`

### 4.3 导入 Neo4j 演示数据（固定）

本项目的图查询与溯源任务依赖 Neo4j 图数据。图数据通过固定脚本导入：

```bash
cd backend
uv run python scripts/import_test_data.py
```

## 5. 停机与清理

停机与清理在 `95-重置复现与排障.md` 定义，本文件不重复。
