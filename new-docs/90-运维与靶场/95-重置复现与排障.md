# 重置复现与排障

本文件给出靶场的固定重置步骤、固定复现步骤与固定排障顺序，保证每次演示从干净状态开始。

## 1. 重置（固定步骤）

### 1.1 停机（固定）

1. 停止前端（运行 `npm run dev` 的终端按 `Ctrl+C`）  
2. 停止后端（运行 `uvicorn` 的终端按 `Ctrl+C`）  
3. 停止三套 Docker Compose：客户机、C2、中心机依赖  

```bash
cd client
docker compose down -v

cd ../deploy/c2
docker compose down -v

cd ../../backend
docker compose down -v
```

### 1.2 清理数据（固定）

```bash
rm -rf client/data/*
```

通过标准（固定）：

- `client/data/` 目录为空；
- 重新启动客户机后，`client/data/` 会重新产生 `falco.jsonl` 与 `eve.json` 等输出文件。

## 2. 复现（固定步骤）

复现步骤固定为：

1. 按 `92-一键编排.md` 启动全部服务；
2. 按 `93-C2部署与证据点.md` 执行 DNS 与 HTTP 两条证据命令；
3. 按 `94-验证清单.md` 完成网络、采集、入库与证据点验证。

## 3. 排障顺序（固定）

排障严格按以下顺序执行，不允许跳步：

1. **后端健康检查**：`curl -sS http://localhost:8000/health` 必须返回 `{"status":"ok"}`  
2. **OpenSearch 可用**：`curl -k -u admin:OpenSearch@2024!Dev https://localhost:9200/_cluster/health` 必须返回 `yellow|green`  
3. **客户机接口可用**：`curl -sS http://10.92.35.13:8888/suricata` 必须返回 JSON 且包含 `total`  
4. **注册表可见**：`curl -sS http://localhost:8000/api/v1/clients` 必须包含 `client.id="client-01"`  
5. **Suricata 输出存在**：`client/data/eve.json` 必须存在且文件大小大于 0  

当上述任一项不满足时，直接在该项对应的组件上定位问题，不进入下一项。
