# C2部署与证据点

本文件定义 C2（DNS+HTTP）在靶场中的固定部署方式与固定证据生成方式，用于保证 Suricata 在 `ens5f1` 上稳定观测到 DNS/HTTP 流量。

## 1. 固定约定

本项目靶场对 C2 的固定约定如下：

- C2 独立 IP：`10.92.35.50`
- C2 域名：`c2.lab.local`
- C2 HTTP 路径：
  - `http://c2.lab.local/health`
  - `http://c2.lab.local/payload`

## 2. macvlan 前置条件（必须满足）

- 宿主机内网网卡：`ens5f1`
- 内网网段：`10.92.35.0/24`
- C2 IP `10.92.35.50` 未被占用

## 3. 宿主机创建 macvlan0（固定命令）

macvlan 的默认行为会导致宿主机无法直接访问 macvlan 容器 IP。本项目固定通过创建宿主机 macvlan0 解决该问题。

在宿主机执行：

```bash
sudo ip link add macvlan0 link ens5f1 type macvlan mode bridge
sudo ip addr add 10.92.35.51/24 dev macvlan0
sudo ip link set macvlan0 up
```

## 4. 启动 C2（固定命令）

```bash
cd deploy/c2
docker compose up -d
```

## 5. 验证 C2（固定命令 + 固定预期）

### 5.1 DNS 验证

```bash
dig @10.92.35.50 c2.lab.local A +short
```

预期输出固定为：

```
10.92.35.50
```

### 5.2 HTTP 验证

```bash
curl -sS --resolve c2.lab.local:80:10.92.35.50 http://c2.lab.local/health
```

预期输出固定为：

```
ok
```

## 6. 证据点（固定生成方式）

执行 5.1 与 5.2 两条命令会固定产生：

- DNS 查询流量：`10.92.35.13 -> 10.92.35.50:53`
- HTTP 访问流量：`10.92.35.13 -> 10.92.35.50:80`

这些流量必须被客户机侧 Suricata 在 `ens5f1` 上观测到，验证步骤见：

- `94-验证清单.md`
