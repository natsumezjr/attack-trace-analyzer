# 靶场部署

本文件定义课程演示靶场的固定拓扑、固定 IP 规划、固定端口规划与固定数据目录位置。

## 1. 固定拓扑（3 个角色）

本项目演示靶场固定由 3 个角色构成，均部署在同一台内网 Linux 宿主机上：

| 角色 | 部署形态 | 作用 |
|---|---|---|
| 中心机 | OpenSearch+Neo4j 为 Docker Compose；后端与前端为宿主进程 | 数据入库、检测融合、图查询与任务执行、前端展示 |
| 客户机 | Docker Compose | Falco/Filebeat/Suricata 采集 → RabbitMQ 缓冲 → 客户机拉取 API |
| C2 | Docker Compose（macvlan 独立 IP） | DNS+HTTP 服务，用于产生稳定可观测的网络证据 |

## 2. 固定地址与网卡规划

靶场网络口径固定为：

- 宿主机内网 IP：`10.92.35.13`
- 宿主机抓包网卡：`ens5f1`
- C2 独立 IP：`10.92.35.50`
- C2 域名：`c2.lab.local`

> 说明：C2 使用 macvlan 的唯一目标是让 DNS/HTTP 访问产生真实的二层出网流量，从而能被 Suricata 在 `ens5f1` 上稳定观测到。

## 3. 固定端口规划

### 3.1 中心机端口（宿主机）

- OpenSearch：`9200/tcp`、`9600/tcp`
- Neo4j：`7474/tcp`、`7687/tcp`
- 后端 API：`8000/tcp`
- 前端：`3000/tcp`

### 3.2 客户机端口（宿主机）

- RabbitMQ：`5672/tcp`、`15672/tcp`
- 客户机拉取 API：`8888/tcp`

### 3.3 C2 端口（C2 独立 IP）

由于 C2 拥有独立 IP，不做宿主端口映射，端口固定为：

- DNS：`53/udp`、`53/tcp`
- HTTP：`80/tcp`

## 4. 固定数据目录

靶场运行产生的数据固定落在以下位置：

- 客户机采集输出：`client/data/`
- C2 配置与静态页面：`deploy/c2/`（见 `93-C2部署与证据点.md`）
- OpenSearch/Neo4j 持久化：Docker named volumes（由 `backend/docker-compose.yml` 创建）

重置与清理步骤见：

- `95-重置复现与排障.md`

## 5. 下一步

一键启动/停止与启动顺序见：

- `92-一键编排.md`
