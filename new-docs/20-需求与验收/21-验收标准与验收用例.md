# 验收标准与验收用例

## 文档目的

本文件将需求文档中的验收目标转化为可执行的验收用例，给出固定的验收步骤、证据点与失败判定标准。

## 读者对象

- 老师与助教（用于现场评分）
- 团队内部测试负责人（用于准备验收材料）
- 负责演示的同学（用于演示脚本对齐）

## 引用关系

- 需求分析：`20-需求分析报告.md`
- 攻击复现剧本：`22-攻击场景与复现剧本.md`
- 运维与验证：`../90-运维与靶场/94-验证清单.md`

## 1. 验收总则

1. 验收以“可演示、可解释、可复现”为准。
2. 任意结论必须可回溯到证据事件 `event.id`。
3. 现场验收严格按本文件步骤执行，不允许临时更换流程或更换数据口径。

## 2. 用例清单

| 用例编号 | 用例名称 | 关联需求 |
|---|---|---|
| AC-01 | 多节点在线与轮询拉取 | FR-01、FR-03 |
| AC-02 | 多源事件入库与字段口径 | FR-02、NFR-02 |
| AC-03 | 告警产生与融合生成 Canonical | FR-04、FR-03 |
| AC-04 | 图谱可视化查询 | FR-05 |
| AC-05 | 创建溯源任务与状态轮询 | FR-06 |
| AC-06 | 溯源结果写回与可解释展示 | FR-07、NFR-01 |
| AC-07 | APT 相似度匹配输出 | FR-08 |
| AC-08 | 报告导出可复现 | FR-09、NFR-04 |

## 3. 验收用例

### AC-01 多节点在线与轮询拉取

**前置条件**

- 按 `../90-运维与靶场/90-编译安装与使用.md` 启动中心机与至少 5 个客户机节点
- 客户机已在中心机注册表中存在

**验收步骤**

1. 在中心机查看客户机注册表，确认至少 5 个客户机条目存在。
2. 等待一个轮询周期后，确认每个客户机的 `poll.status` 为正常或部分正常。

**证据点**

- 客户机列表截图
- 每个客户机的 `poll.last_seen` 更新时间截图

**失败判定**

- 客户机数量不足 5 个
- 任意客户机持续处于 `timeout` 或 `error` 状态超过 3 个轮询周期

### AC-02 多源事件入库与字段口径

**前置条件**

- 运行固定攻击复现：`22-攻击场景与复现剧本.md`

**验收步骤**

1. 在 OpenSearch 中查询时间窗内的 Telemetry 事件。
2. 抽样检查每个数据源至少存在一条事件：Falco、Filebeat、Suricata。
3. 抽样检查字段口径：`event.id`、三时间字段、`event.kind`、`event.dataset`、`host.id`。

**证据点**

- Telemetry 查询结果截图
- 抽样事件 JSON 截图（含字段）

**失败判定**

- 任一数据源无数据
- 事件缺少 `event.id` 或三时间字段

### AC-03 告警产生与融合生成 Canonical

**前置条件**

- 中心机已启用告警分析与融合机制

**验收步骤**

1. 查询 Raw Finding 索引，确认存在告警文档。
2. 查询 Canonical Finding 索引，确认存在 `event.dataset="finding.canonical"` 的文档。
3. 抽样检查 Canonical 的证据引用 `custom.evidence.event_ids` 可回溯到 Telemetry。

**证据点**

- Raw 与 Canonical 查询结果截图
- Canonical 文档中证据引用字段截图

**失败判定**

- 只有 Raw 无 Canonical
- Canonical 不包含证据引用

### AC-04 图谱可视化查询

**验收步骤**

1. 在前端选择固定时间窗，发起图查询。
2. 图中出现节点与边，并可点击查看边属性。

**证据点**

- 图谱截图
- 边属性中 `event.id` 与证据引用字段截图

**失败判定**

- 图查询无返回或返回为空
- 图边缺少时间窗字段或证据字段

### AC-05 创建溯源任务与状态轮询

**验收步骤**

1. 在前端点选一个图节点，创建溯源任务。
2. 前端获得 `task_id` 并开始轮询。
3. 任务状态按 `queued -> running -> succeeded/failed` 变化。

**证据点**

- 创建任务返回 `task_id` 的截图
- 任务状态轮询变化截图

**失败判定**

- 无法创建任务
- 任务状态不符合状态机

### AC-06 溯源结果写回与可解释展示

**验收步骤**

1. 等待任务完成。
2. 重新查询图数据，筛选 `analysis.task_id` 等于当前任务。
3. 展示关键路径边与解释字段。

**证据点**

- 关键边高亮截图
- 边属性 `analysis.*` 字段截图

**失败判定**

- 任务完成但边属性无写回
- 写回字段不包含 `analysis.task_id`

### AC-07 APT 相似度匹配输出

**验收步骤**

1. 创建溯源任务并等待完成。
2. 查看任务结果中的 Top-3 相似组织输出与解释性 techniques。

**证据点**

- 任务结果字段截图

**失败判定**

- 任务结果缺少相似度输出字段

### AC-08 报告导出可复现

**验收步骤**

1. 使用相同时间窗导出两次报告。
2. 两次报告的关键内容一致：时间线摘要、关键图数据、Technique 覆盖、溯源结果摘要。

**证据点**

- 两次导出文件的对比截图

**失败判定**

- 同输入导出内容差异明显且无法解释

