# 部署拓扑与网络规划

## 文档目的

本文件定义本项目靶场的节点拓扑、网络规划、端口规划与访问边界，用于保证现场演示的部署一致性与可复现性。

## 读者对象

- 靶场负责人
- 负责部署与编排的同学
- 负责答辩演示的同学

## 引用关系

- 详细部署步骤：`../90-运维与靶场/91-靶场部署.md`
- 一键编排：`../90-运维与靶场/92-一键编排.md`
- 接口与端口约定：`../80-规范/87-客户机与中心机接口.md`

## 1. 节点与角色

靶场节点角色固定为：

- `center`：中心机（OpenSearch、Neo4j、后端 API、前端）
- `client-01` 到 `client-04`：客户机节点（采集与缓冲）
- `c2`：命令与控制服务器（用于产生可观测通信证据）

## 2. 网络规划

网络规划遵循以下原则：

1. 靶场网络与宿主机外网隔离，所有演示数据在靶场内闭环。
2. 中心机对外暴露的端口只面向靶场网络可达范围。
3. 客户机只向中心机暴露拉取接口，不对外提供其他服务端口。

## 3. 端口规划

端口清单与用途如下：

| 组件 | 端口 | 用途 |
|---|---:|---|
| center 后端 | 8000 | API 服务与健康检查 |
| center 前端 | 3000 | 可视化 UI |
| OpenSearch | 9200 | 存储与检索 |
| Neo4j Bolt | 7687 | Neo4j 驱动连接 |
| Neo4j Browser | 7474 | Neo4j Web 控制台 |
| 客户机拉取 API | 8888 | 供中心机轮询拉取 Falco Filebeat Suricata 数据 |

## 4. 部署拓扑

部署拓扑遵循“中心机集中、客户机分布”的结构：

1. 客户机采集数据并缓冲在本地队列
2. 中心机周期性轮询拉取客户机数据
3. 中心机写入 OpenSearch，并根据需要触发检测与告警融合
4. 中心机将数据入图到 Neo4j，前端通过中心机 API 查询展示

## 5. 安全边界与隔离

1. 中心机不运行未知样本，不执行来自外部的不可信代码。
2. 靶场网络中所有组件的访问鉴权与令牌由接口规范定义。
3. 现场演示以稳定性为第一目标，任何需要人工介入的步骤都必须写入运维文档。
