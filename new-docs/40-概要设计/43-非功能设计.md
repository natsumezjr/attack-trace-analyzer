# 非功能设计

## 文档目的

本文件将需求中的非功能要求落地为确定的工程设计约束，覆盖幂等、一致性、可解释、性能、稳定性与可复现性。

## 读者对象

- 负责系统架构与后端实现的同学
- 负责测试与验收的同学

## 引用关系

- 需求分析：`../20-需求与验收/20-需求分析报告.md`
- 数据与规范：`../80-规范/`
- 测试报告：`../96-测试/96-测试分析报告.md`

## 1. 幂等与去重

### 1.1 OpenSearch 幂等

系统以 `event.id` 作为全局幂等键：

- 同一 `event.id` 重复写入 OpenSearch 不产生重复文档
- `event.id` 的生成规则由 `../80-规范/81-ECS字段规范.md` 定义

### 1.2 图谱幂等

Neo4j 节点写入使用唯一键约束保证幂等；边写入携带证据引用并具备可过滤的去重口径，具体规范见：

- `../80-规范/84-Neo4j实体图谱规范.md`
- `../80-规范/85-溯源结果写回规范.md`

## 2. 一致性与可回放

一致性目标：

1. 同一批输入事件在重复拉取与重复执行下，OpenSearch 与 Neo4j 的关键输出一致。
2. 任意告警与溯源结论可回溯到 Telemetry 的 `event.id` 证据。

## 3. 可解释与证据链

可解释性要求：

- 前端展示的告警、边与溯源结果必须包含证据引用
- 溯源写回字段使用统一前缀 `analysis.`，字段集合与覆盖规则由 `../80-规范/85-溯源结果写回规范.md` 定义

## 4. 性能目标与容量边界

性能目标：

- 图查询在秒级返回满足可视化展示的数据量
- 溯源任务允许长耗时，但必须提供可轮询的状态与进度

容量边界与数据保留策略见：

- `../80-规范/80-数据对象与生命周期.md`

## 5. 稳定性与故障处理

故障处理原则：

1. 单次轮询失败不影响后续轮询继续执行
2. LLM 调用失败必须走固定回退路径，保证演示不因外部服务中断而失败
3. 数据重置与复现流程固定，见 `../90-运维与靶场/95-重置复现与排障.md`

