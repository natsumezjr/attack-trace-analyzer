# 测试用例与结果明细

## 文档目的

本文件列出测试用例的执行步骤、期望结果、实际结果与证据位置，便于复核与复现。

## 读者对象

- 团队内部测试负责人
- 负责演示的同学

## 引用关系

- 验收用例：`../20-需求与验收/21-验收标准与验收用例.md`

## 1. 用例列表

本项目测试用例分为两类：

- 自动化测试用例：以 `pytest` 为入口，结果以命令输出为准
- 验收测试用例：以 AC-01 到 AC-08 为入口，结果以截图与录像证据为准

用例清单固定如下：

| 用例编号 | 用例名称 | 类型 | 执行入口 | 结果 |
|---|---|---|---|---|
| TC-AUTO-01 | 后端快速回归测试 | 自动化 | `cd backend && RUN_NEO4J_TESTS=0 uv run pytest -q` | 通过 |
| TC-AUTO-02 | 后端全量集成测试 | 自动化 | `cd backend && RUN_OPENSEARCH_TESTS=1 RUN_NEO4J_TESTS=1 KEEP_NEO4J_TEST_DATA=0 uv run pytest -q` | 通过 |
| AC-01 | 多节点在线与轮询拉取 | 验收 | `../20-需求与验收/21-验收标准与验收用例.md` | 待现场验收 |
| AC-02 | 多源事件入库与字段口径 | 验收 | `../20-需求与验收/21-验收标准与验收用例.md` | 待现场验收 |
| AC-03 | 告警产生与融合生成 Canonical | 验收 | `../20-需求与验收/21-验收标准与验收用例.md` | 待现场验收 |
| AC-04 | 图谱可视化查询 | 验收 | `../20-需求与验收/21-验收标准与验收用例.md` | 待现场验收 |
| AC-05 | 创建溯源任务与状态轮询 | 验收 | `../20-需求与验收/21-验收标准与验收用例.md` | 待现场验收 |
| AC-06 | 溯源结果写回与可解释展示 | 验收 | `../20-需求与验收/21-验收标准与验收用例.md` | 待现场验收 |
| AC-07 | APT 相似度匹配输出 | 验收 | `../20-需求与验收/21-验收标准与验收用例.md` | 待现场验收 |
| AC-08 | 报告导出可复现 | 验收 | `../20-需求与验收/21-验收标准与验收用例.md` | 待现场验收 |

## 2. 用例明细

### 2.1 TC-AUTO-01 后端快速回归测试

**目的**

在不启动 Neo4j 的条件下验证后端核心逻辑可运行，保证每次提交的快速回归结果稳定。

**执行步骤**

1. 进入后端目录：`cd backend`
2. 执行测试：`RUN_NEO4J_TESTS=0 uv run pytest -q`

**期望结果**

- 测试完成，退出码为 0
- 输出包含：`121 passed, 62 skipped`

**实际结果**

- 通过：`121 passed, 62 skipped in 0.20s`

**证据位置**

- 终端输出截图：见本文件第 3 节命名规则

### 2.2 TC-AUTO-02 后端全量集成测试

**目的**

在 OpenSearch 与 Neo4j 均运行的条件下验证后端完整链路可运行，覆盖存储、查询、去重、图谱入库与溯源分析关键路径。

**执行步骤**

1. 启动基础设施（OpenSearch + Neo4j）：`cd backend && docker compose up -d`
2. 执行测试：`cd backend && RUN_OPENSEARCH_TESTS=1 RUN_NEO4J_TESTS=1 KEEP_NEO4J_TEST_DATA=0 uv run pytest -q`

**期望结果**

- 测试完成，退出码为 0
- 输出包含：`182 passed, 1 skipped`

**实际结果**

- 通过：`182 passed, 1 skipped, 36 warnings in 196.58s`
- 跳过用例：`tests/opensearch/test_system_opensearch.py:362`（需要 mock OpenSearch 连接）

**证据位置**

- 终端输出截图：见本文件第 3 节命名规则

### 2.3 AC-01 到 AC-08 现场验收用例

**统一执行入口**

1. 固定复现剧本：`../20-需求与验收/22-攻击场景与复现剧本.md`
2. 固定验收步骤：`../20-需求与验收/21-验收标准与验收用例.md`
3. 固定证据口径：`../10-交付与答辩/14-录像与截图清单.md`、`../90-运维与靶场/94-验证清单.md`

**期望结果**

- 每条验收用例均能定位到 OpenSearch 事件证据 `event.id`
- 图谱与溯源任务输出字段满足规范文档口径

**证据位置**

- 截图与录像存放目录固定为提交包内：`09-截屏录像/`

## 3. 证据索引

### 3.1 截图与录像命名规则

文件命名与存放规则统一以 `../10-交付与答辩/14-录像与截图清单.md` 为准：

- 截图：`YYYYMMDD-序号-证据主题.png`
- 录像：`YYYYMMDD-项目演示.mp4`

### 3.2 自动化测试证据清单

自动化测试证据固定为两张截图：

1. `YYYYMMDD-01-pytest-后端快速回归.png`（对应 TC-AUTO-01）
2. `YYYYMMDD-02-pytest-后端全量集成.png`（对应 TC-AUTO-02）
